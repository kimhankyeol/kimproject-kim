<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- JAVA와 연결할 Mapper 파일 설정 -->
<mapper namespace="poly.persistance.mapper.SpeechMapper">
	<insert id="insertSpeech" parameterType="SpeechDTO">
		INSERT 
		INTO 
			Speech(
			spcJobTag,
			spcJobTitle,
			spcJobQuestion,
			regdate,
			regno
			)
		VALUES(
			#{spcJobTag},
			#{spcJobTitle},
			#{spcJobQuestion},
			now(),
			#{regno}
		) 
	</insert>
	<select id="getMySpeechList" parameterType="SpeechDTO" resultType="SpeechDTO">
		SELECT
		* 
		FROM
		SPEECH
		WHERE 
		regno=#{regno}
	</select>
	<select id="getSpeechList" resultType="SpeechDTO">
		SELECT
		*
		FROM
		SPEECH
	</select>
	<select id="getSpeechDetail" parameterType="SpeechDTO" resultType="SpeechDTO">
		SELECT 
		*
		FROM
		SPEECH
		WHERE
		speechNo = #{speechNo}
	</select>
	<insert id="insertFileSpeech" parameterType="map">
		INSERT INTO file(
			fileOriginName,
			fileNewName,
			filePath,
			speechNo,
			regno
		)
		VALUES
		(
			#{fDTO.fileOriginName},
			#{fDTO.fileNewName},
			#{fDTO.filePath},
			#{sDTO.speechNo},
			#{sDTO.regno}
		)
	</insert>
	<select id="getAnswerList" parameterType="SpeechDTO"  resultMap="speech">
	SELECT 
	S.spcJobTitle AS spcJobTitle,
	S.spcJobQuestion AS spcJobQuestion,
	U.userNo AS userNo,
	U.userName AS userName,
	F.fileNewName AS fileNewName
	FROM
	SPEECH S
	INNER JOIN FILE F
	ON F.speechNo = S.speechNo AND F.speechNo = #{speechNo}
	INNER JOIN USER U
	ON F.regno = U.userNo 
	</select>
	
	<!-- resultMap SpeechDTO FileDTO UserDTO -->
	<resultMap type="FileDTO" id="FileDTO">
		<result column="fileNewName" property="fileNewName"/>
	</resultMap>
	<resultMap type="UserDTO" id="UserDTO">
		<result column="userNo" property="userNo"/>
		<result column="userName" property="userName"/>
	</resultMap>
	<resultMap type="SpeechDTO" id="speech" >
		<result column="speechNo" property="speechNo"/>
		<result column="spcJobTitle" property="spcJobTitle"/>
		<result column="spcJobQuestion" property="spcJobQuestion"/>
		<collection property="file" resultMap="FileDTO"></collection>
		<collection property="user" resultMap="UserDTO"></collection>
	</resultMap>
</mapper>

